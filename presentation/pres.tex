\documentclass[page number,usenames,dvipsnames]{beamer}
\usetheme[sectionpage=none,numbering=fraction,progressbar=foot]{metropolis}

\usepackage{pgf,tikz}
\usetikzlibrary{arrows}
\usetikzlibrary{positioning,shapes,fit}
\usepackage{graphicx}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{pgf,tikz}
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{wrapfig}
\usetikzlibrary{positioning,shapes}
\usepackage{multicol}
\usepackage{btreecursor}
\usepackage{lstcoq}

\makeatletter
\makeatother

\setcounter{tocdepth}{1} % remove subsection from table of contents

% colors
\definecolor{mDarkRed}{HTML}{6F1616}
\definecolor{mDarkGreen}{HTML}{106235}
\definecolor{mTeal}{HTML}{112233}
\definecolor{mBlack}{HTML}{000000}
\setbeamercolor{normal text}{fg=mTeal}
\setbeamercolor{alerted text}{fg=mDarkRed}
\setbeamercolor{example text}{fg=mDarkGreen}
\setbeamercolor{title separator}{fg=purple,bg=mBlack}

\def\outline{
  \begin{frame}[plain,noframenumbering]
    \frametitle{Outline}
    \tableofcontents[currentsection]
  \end{frame}
}


\begin{document}
\title[shorttitle]{VST Verification of B+Trees with Cursors}

\author[Aur\`ele Barri\`ere]{Aur\`ele Barri\`ere}

\date{\textit{ENS Rennes}
  \vfill
  \textbf{March 1st, 2018 - June 29th, 2018}}

\def\outline{
  \begin{frame}[plain,noframenumbering]
    \frametitle{Outline}
    \tableofcontents[currentsection]
  \end{frame}
}

\include{figures}

\begin{frame}[plain,noframenumbering]
  \vspace{-2cm}
  \maketitle
  \vspace{-4cm}
\end{frame}

%% \metroset{sectionpage=none}

%% \metroset{sectionpage=progressbar}

\section{Introduction}
\begin{frame}{Introduction}
  % introduction to software verif
\end{frame}

\begin{frame}{B+Trees}
  % presentation of B+Trees library
  \beforeinsert
  \vfill
  % properties
  \begin{multicols}{2}
    \begin{exampleblock}{Properties}
      \begin{itemize}
      \item Ordered
      \item Balanced
      \item Fanout
      \end{itemize}
    \end{exampleblock}
      \begin{block}{Operations}
        \begin{itemize}
        \item Insert key and record
        \item Get record of given key
        \item {\color{mDarkRed}Delete record of given key}
        \item Range queries
        \end{itemize}
      \end{block}
  \end{multicols}

  % operations
\end{frame}

\begin{frame}{B+Trees Insertion}
  \beforeinsert
  \vfill
  \pause
  \afterinsert
\end{frame}

\begin{frame}{Cursors}
  % example.
  \cursor
  \vfill
  % operations
  \begin{block}{Operations}
    \begin{itemize}
    \item Insert key and record
    \item Get record pointed to by the cursor
    \item Move cursor to given key
    \item Move cursor to next or previous key
    \item Move cursor to first or last key
    \end{itemize}
  \end{block}
  % complexity
\end{frame}

\section{VST}
\begin{frame}{Hoare and Separation Logic}
  % Hoare triples

  % Separation
  % another slide for that one? * and -*
  
\end{frame}

\begin{frame}{The Verified Software Toolchain}

  % general presentation
  
\end{frame}

\begin{frame}[fragile]{Specifying a C program with VST}
 \begin{lstlisting}[language=Coq,basicstyle=\scriptsize]
Definition moveToFirst_spec : ident * funspec :=
  DECLARE _moveToFirst
  WITH r:relation val, c:cursor val, pc:val, n:node val
  PRE[ _node OF tptr tbtnode, _cursor OF tptr tcursor, _level OF tint ]
    PROP(partial_cursor c r; next_node c (get_root r) = Some n)
    LOCAL(temp _cursor pc; temp _node (getval n);
          temp _level (Vint(Int.repr(Zlength c))))
    SEP(relation_rep r; cursor_rep c r pc)
  POST[ tvoid ]
    PROP()
    LOCAL()
    SEP(relation_rep r; cursor_rep (moveToFirst n c (length c)) r pc).
\end{lstlisting}
\end{frame}


\begin{frame}{Proving a C program correct with VST}

  % step through a proof?
  % forward, forward_if, forward_proof
  % prove array in range etc...
  
\end{frame}

\section{Verification}
\begin{frame}{A B+Tree with Cursors formal model}

  % types
  % example function, movetonext
  
\end{frame}

\begin{frame}{Specifications}

  % example
\end{frame}

\begin{frame}{Proving each function correct}

  % results.
  % anything left to prove?

\end{frame}

\begin{frame}{Bugs of the Original Implementation}
  
  % buildnig cursor for non key values
  % wrong array access
  % wrong complexity
  % others
\end{frame}

\section{Future Work}
\begin{frame}{DeepDB}
  % towards a high-performance database like MassTree
  % Tries of Btrees. How does that work with the proofs

\end{frame}
  
\end{document}
